<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>

<BorderPane prefHeight="700.0" prefWidth="900.0" styleClass="root" stylesheets="@/css/styles.css"
            xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.prioriza.controller.MainController"
            fx:id="rootpane">

    <!-- TOP - Contenedor principal de la barra superior -->
    <top>
        <VBox spacing="0" styleClass="top-bar-container">
            <!-- MENÚ BAR -->
            <MenuBar styleClass="menu-bar">
            <!-- MENÚ PARA TODOS LOS USUARIOS -->
                <Menu text="Notificaciones">
                    <MenuItem text="Mis estadísticas" onAction="#handleUserNotificationStats"/>
                    <MenuItem text="Próximas tareas" onAction="#handleUpcomingTasks"/>
                    <MenuItem text="Configurar alertas" onAction="#handleNotificationSettings"/>
                </Menu>
                <!-- MENÚ SOLO ADMIN - CON fx:id -->
                <Menu fx:id="adminMenu" text="Admin">
                    <MenuItem fx:id="scanNowMenuItem" text="Escaneo manual" onAction="#handleScanNow"/>
                    <MenuItem fx:id="sendNowMenuItem" text="Envío forzado" onAction="#handleSendNow"/>
                    <MenuItem fx:id="testNotificationsMenuItem" text="Probar sistema" onAction="#handleTestNotifications"/>
                    <SeparatorMenuItem />
                    <MenuItem fx:id="globalStatsMenuItem" text="Estadísticas globales" onAction="#handleGlobalStats"/>
                </Menu>
                <!-- ARCHIVO -->
                <Menu text="Archivo">
                <!-- Exportar PDF -->
                    <Menu text="Exportar PDF">
                        <MenuItem text="Lista actual" onAction="#handleExportListToPDF"/>
                        <MenuItem text="Tarea seleccionada" onAction="#handleExportTaskToPDF"/>
                        <MenuItem text="Subtarea seleccionada" onAction="#handleExportSubtaskToPDF"/>
                        <SeparatorMenuItem />
                        <MenuItem text="Todo (exportar todo)" onAction="#handleExportEverythingToPDF"/>
                    </Menu>
                <!-- COMPARTIR -->
                    <Menu text="Compartir">
                        <MenuItem text="Lista actual" onAction="#handleShareList"/>
                        <MenuItem text="Tarea seleccionada" onAction="#handleShareTask"/>
                        <MenuItem text="Subtarea seleccionada" onAction="#handleShareSubtask"/>
                    </Menu>

                </Menu>
            </MenuBar>

            <!-- BARRA SUPERIOR -->
            <HBox fx:id="topBar" alignment="CENTER_LEFT" spacing="15" styleClass="top-bar">

                <!-- Logo y título -->
                <HBox spacing="12" alignment="CENTER_LEFT">
                    <ImageView fitHeight="32" preserveRatio="true">
                        <image>
                            <Image url="@/img/prioriza-icono.png" />
                        </image>
                    </ImageView>
                    <VBox spacing="2">
                        <Label styleClass="app-title" text="PRIORIZA" />
                        <Label styleClass="app-subtitle" text="Gestor Inteligente de Tareas" />
                    </VBox>
                </HBox>

                <Region HBox.hgrow="ALWAYS" />

                <!-- User info y logout -->
                <HBox alignment="CENTER_RIGHT" spacing="10" styleClass="user-box">
                    <Label styleClass="user-status" text="⬤" />
                    <Label fx:id="userLabel" styleClass="user-label" text="Usuario" />
                    <Button onAction="#handleLogout" styleClass="logout-button" text="Cerrar sesión" />
                </HBox>

            </HBox>

        </VBox>
    </top>

    <!-- CENTER - (cards, listas, tablas) -->
    <center>
        <HBox spacing="15" styleClass="main-container">
            <!-- Mis listas -->
            <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS" VBox.vgrow="ALWAYS">
                <Label styleClass="section-title" text="Mis listas" />
                <ListView fx:id="taskListView" VBox.vgrow="ALWAYS" />
                <HBox alignment="CENTER" spacing="10">
                    <Button onAction="#handleNewList" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/agregar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Nueva lista"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleEditList" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/editar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Editar lista"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleDeleteListTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/eliminar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Eliminar lista"/>
                        </tooltip>
                    </Button>
                </HBox>
            </VBox>

            <!-- Tareas -->
            <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS" VBox.vgrow="ALWAYS">
                <Label styleClass="section-title" text="Tareas" />
                <TableView fx:id="taskTableView" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colTitle" text="Título" />
                        <TableColumn fx:id="colDescription" text="Descripción" />
                        <TableColumn fx:id="colPriority" text="Prioridad" />
                        <TableColumn fx:id="colDueDate" text="Fecha" />
                        <TableColumn fx:id="colStatus" text="Estado" />
                    </columns>
                </TableView>
                <HBox alignment="CENTER" spacing="10">
                    <Button onAction="#handleNewTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/agregar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Nueva tarea"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleEditTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/editar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Editar tarea"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleDeleteTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/eliminar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Eliminar tarea"/>
                        </tooltip>
                    </Button>
                </HBox>
            </VBox>

            <!-- Subtareas -->
            <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS" VBox.vgrow="ALWAYS">
                <Label styleClass="section-title" text="Subtareas" />
                <ListView fx:id="subTaskView" VBox.vgrow="ALWAYS" />
                <HBox alignment="CENTER" spacing="10">
                    <Button onAction="#handleNewSubTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/agregar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Nueva subtarea"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleEditSubTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/editar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Editar subtarea"/>
                        </tooltip>
                    </Button>
                    <Button onAction="#handleDeleteSubTask" styleClass="icon-button">
                        <graphic>
                            <ImageView fitWidth="32" fitHeight="32" preserveRatio="true">
                                <image>
                                    <Image url="@/img/eliminar.png"/>
                                </image>
                            </ImageView>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Eliminar subtarea"/>
                        </tooltip>
                    </Button>
                </HBox>
            </VBox>
        </HBox>
    </center>

</BorderPane>
